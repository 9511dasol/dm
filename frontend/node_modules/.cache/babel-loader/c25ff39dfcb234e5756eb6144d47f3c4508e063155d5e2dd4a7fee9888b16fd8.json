{"ast":null,"code":"var _jsxFileName = \"C:\\\\Mtest\\\\workdjango\\\\instagram\\\\frontend\\\\src\\\\DM\\\\DirectMessages.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport styled from \"styled-components\";\nimport ChatWindow from \"./components//ChatWindow\";\nimport MessageInput from \"./components/MessageInput\";\nimport ChatList from \"./components/ChatList\";\nimport axios from \"axios\";\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst AppContainer = styled.div`\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  height: 100vh;\n  background-color: #fafafa;\n`;\n_c = AppContainer;\nconst AppBox = styled.div`\n  width: 100%;\n  height: 100%;\n  border: 1px solid #dbdbdb;\n  border-radius: 10px;\n  background-color: black;\n  display: flex;\n  flex-direction: row;\n`;\n_c2 = AppBox;\nconst ChatSection = styled.div`\n  display: flex;\n  flex-direction: column;\n  flex: 2;\n`;\n_c3 = ChatSection;\nconst DirectMessages = () => {\n  _s();\n  const currentUserid = 6;\n  // const [chats, setChats] = useState([]);\n  const [chats, setChats] = useState([{\n    id: 1,\n    name: 'John Doe',\n    messages: []\n  }, {\n    id: 2,\n    name: 'Jane Smith',\n    messages: []\n  }, {\n    id: 3,\n    name: 'John',\n    messages: []\n  }, {\n    id: 4,\n    name: 'Minji',\n    messages: []\n  }]);\n  const [selectedChatId, setSelectedChatId] = useState(null);\n  useEffect(() => {\n    fetchChats(); // 컴포넌트가 처음 마운트될 때 채팅 목록을 가져오는 함수 호출\n  }, [currentUserid]); // currentUserid가 변경될 때마다 useEffect 호출\n\n  // useEffect(() => {\n  //   const chatSocket = new WebSocket(\n  //     `ws://${window.location.host}/ws/chat/${selectedChatId}/`\n  //   );\n\n  //   chatSocket.onmessage = function (e) {\n  //     const data = JSON.parse(e.data);\n  //     const { sender, receiver, message } = data;\n\n  //     // 새로운 메시지를 상태에 추가\n  //     const newMessage = {\n  //       text: message.text,\n  //       send: false,\n  //       sent_at: message.timestamp,\n  //     };\n  //     setChats((prevMessages) => [...prevMessages, newMessage]);\n\n  //     // 메시지를 수신하면 해당 메시지를 서버에 저장하고, 채팅 목록을 다시 가져오는 예시\n  //     axios\n  //       .get(\"http://127.0.0.1:8000/dm.do\", {\n  //         params: {\n  //           select: 3,\n  //           dm: message.text,\n  //           me: receiver,\n  //           you: sender,\n  //         },\n  //       })\n  //       .then((response) => {\n  //         console.log(\"Message saved successfully:\", response.data);\n  //         fetchChats();\n  //         // 필요하다면 추가적인 로직 수행\n  //       })\n  //       .catch((error) => {\n  //         console.error(\"Error saving message:\", error);\n  //       });\n  //   };\n  //   // 컴포넌트 언마운트 시 소켓 연결 해제\n  //   return () => {\n  //     chatSocket.close();\n  //   };\n  // }, []);\n\n  const fetchChats = () => {\n    axios.get(\"http://127.0.0.1:8000/dm.do\", {\n      params: {\n        curId: currentUserid,\n        select: 1\n      }\n    }).then(response => {\n      const sortedChats = response.data.sort((a, b) => new Date(b.createdat) - new Date(a.createdat));\n      setChats(sortedChats);\n    }).catch(error => {\n      console.error(\"Error fetching chats:\", error);\n    });\n  };\n  const sendMessage = message => {\n    // 메시지를 보내는 함수 (예: handleSend 함수 내부와 동일)\n    axios.get(\"http://127.0.0.1:8000/dm.do\", {\n      params: {\n        select: 2,\n        dm: message.text,\n        me: currentUserid,\n        you: selectedChatId\n      }\n    }).then(response => {\n      // 메시지 전송 후 채팅 목록을 다시 가져옴\n      fetchChats();\n    }).catch(error => {\n      console.error(\"Error sending message:\", error);\n    });\n  };\n\n  // const receiveMessage = () => {\n  //   const chatSocket = new WebSocket(`ws://${window.location.host}/ws/chat/${selectedChatId}/`);\n\n  //   chatSocket.onmessage = function (e) {\n  //     const data = JSON.parse(e.data);\n  //     // 받은 메시지 처리 로직 (예시: 채팅 목록을 다시 가져오는 것처럼)\n  //     const { sender, receiver, message } = data;\n  //     axios.get(\"http://127.0.0.1:8000/dm.do\", {\n  //       params: {\n  //         select: 3,\n  //         dm: message.text,\n  //         me: receiver,\n  //         you: sender,\n  //       },\n  //     }).then((response) => {\n  //       // 메시지 전송 후 채팅 목록을 다시 가져옴\n  //       fetchChats();\n  //     }).catch(error => {\n  //       console.error('Error sending message:', error);\n  //     });\n  //   };\n\n  //   chatSocket.onclose = function (e) {\n  //     console.error('Chat socket closed unexpectedly');\n  //   };\n\n  //   return () => {\n  //     chatSocket.close();\n  //   };\n\n  // };\n\n  const selectChat = id => {\n    //  'id': partner_id,\n    setSelectedChatId(id);\n  };\n  const selectedChat = chats.find(chat => chat.id === selectedChatId);\n  return /*#__PURE__*/_jsxDEV(AppContainer, {\n    children: /*#__PURE__*/_jsxDEV(AppBox, {\n      children: [/*#__PURE__*/_jsxDEV(ChatList, {\n        chats: chats,\n        selectChat: selectChat\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 170,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(ChatSection, {\n        children: selectedChat && /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(ChatWindow, {\n            messages: selectedChat.messages,\n            selectedChatId: selectedChatId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 174,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(MessageInput, {\n            sendMessage: sendMessage,\n            curUserid: currentUserid,\n            receiv_id: selectedChatId\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 178,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 169,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 168,\n    columnNumber: 5\n  }, this);\n};\n_s(DirectMessages, \"AoNn8OV9j4SGgKcyG44IDiV/ZlU=\");\n_c4 = DirectMessages;\nexport default DirectMessages;\nvar _c, _c2, _c3, _c4;\n$RefreshReg$(_c, \"AppContainer\");\n$RefreshReg$(_c2, \"AppBox\");\n$RefreshReg$(_c3, \"ChatSection\");\n$RefreshReg$(_c4, \"DirectMessages\");","map":{"version":3,"names":["React","useState","useEffect","styled","ChatWindow","MessageInput","ChatList","axios","jsxDEV","_jsxDEV","Fragment","_Fragment","AppContainer","div","_c","AppBox","_c2","ChatSection","_c3","DirectMessages","_s","currentUserid","chats","setChats","id","name","messages","selectedChatId","setSelectedChatId","fetchChats","get","params","curId","select","then","response","sortedChats","data","sort","a","b","Date","createdat","catch","error","console","sendMessage","message","dm","text","me","you","selectChat","selectedChat","find","chat","children","fileName","_jsxFileName","lineNumber","columnNumber","curUserid","receiv_id","_c4","$RefreshReg$"],"sources":["C:/Mtest/workdjango/instagram/frontend/src/DM/DirectMessages.js"],"sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport styled from \"styled-components\";\r\nimport ChatWindow from \"./components//ChatWindow\";\r\nimport MessageInput from \"./components/MessageInput\";\r\nimport ChatList from \"./components/ChatList\";\r\nimport axios from \"axios\";\r\n\r\nconst AppContainer = styled.div`\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  height: 100vh;\r\n  background-color: #fafafa;\r\n`;\r\n\r\nconst AppBox = styled.div`\r\n  width: 100%;\r\n  height: 100%;\r\n  border: 1px solid #dbdbdb;\r\n  border-radius: 10px;\r\n  background-color: black;\r\n  display: flex;\r\n  flex-direction: row;\r\n`;\r\n\r\nconst ChatSection = styled.div`\r\n  display: flex;\r\n  flex-direction: column;\r\n  flex: 2;\r\n`;\r\n\r\nconst DirectMessages = () => {\r\n  const currentUserid = 6;\r\n  // const [chats, setChats] = useState([]);\r\n  const [chats, setChats] = useState([\r\n    { id: 1, name: 'John Doe', messages: [] },\r\n    { id: 2, name: 'Jane Smith', messages: [] },\r\n    { id: 3, name: 'John', messages: [] },\r\n    { id: 4, name: 'Minji', messages: [] },\r\n  ]);\r\n  const [selectedChatId, setSelectedChatId] = useState(null);\r\n\r\n  useEffect(() => {\r\n    fetchChats(); // 컴포넌트가 처음 마운트될 때 채팅 목록을 가져오는 함수 호출\r\n  }, [currentUserid]); // currentUserid가 변경될 때마다 useEffect 호출\r\n\r\n  // useEffect(() => {\r\n  //   const chatSocket = new WebSocket(\r\n  //     `ws://${window.location.host}/ws/chat/${selectedChatId}/`\r\n  //   );\r\n\r\n  //   chatSocket.onmessage = function (e) {\r\n  //     const data = JSON.parse(e.data);\r\n  //     const { sender, receiver, message } = data;\r\n\r\n  //     // 새로운 메시지를 상태에 추가\r\n  //     const newMessage = {\r\n  //       text: message.text,\r\n  //       send: false,\r\n  //       sent_at: message.timestamp,\r\n  //     };\r\n  //     setChats((prevMessages) => [...prevMessages, newMessage]);\r\n\r\n  //     // 메시지를 수신하면 해당 메시지를 서버에 저장하고, 채팅 목록을 다시 가져오는 예시\r\n  //     axios\r\n  //       .get(\"http://127.0.0.1:8000/dm.do\", {\r\n  //         params: {\r\n  //           select: 3,\r\n  //           dm: message.text,\r\n  //           me: receiver,\r\n  //           you: sender,\r\n  //         },\r\n  //       })\r\n  //       .then((response) => {\r\n  //         console.log(\"Message saved successfully:\", response.data);\r\n  //         fetchChats();\r\n  //         // 필요하다면 추가적인 로직 수행\r\n  //       })\r\n  //       .catch((error) => {\r\n  //         console.error(\"Error saving message:\", error);\r\n  //       });\r\n  //   };\r\n  //   // 컴포넌트 언마운트 시 소켓 연결 해제\r\n  //   return () => {\r\n  //     chatSocket.close();\r\n  //   };\r\n  // }, []);\r\n\r\n  const fetchChats = () => {\r\n    axios\r\n      .get(\"http://127.0.0.1:8000/dm.do\", {\r\n        params: {\r\n          curId: currentUserid,\r\n          select: 1,\r\n        },\r\n      })\r\n      .then((response) => {\r\n        const sortedChats = response.data.sort(\r\n          (a, b) => new Date(b.createdat) - new Date(a.createdat)\r\n        );\r\n        setChats(sortedChats);\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error fetching chats:\", error);\r\n      });\r\n  };\r\n\r\n  const sendMessage = (message) => {\r\n    // 메시지를 보내는 함수 (예: handleSend 함수 내부와 동일)\r\n    axios\r\n      .get(\"http://127.0.0.1:8000/dm.do\", {\r\n        params: {\r\n          select: 2,\r\n          dm: message.text,\r\n          me: currentUserid,\r\n          you: selectedChatId,\r\n        },\r\n      })\r\n      .then((response) => {\r\n        // 메시지 전송 후 채팅 목록을 다시 가져옴\r\n        fetchChats();\r\n      })\r\n      .catch((error) => {\r\n        console.error(\"Error sending message:\", error);\r\n      });\r\n  };\r\n\r\n  // const receiveMessage = () => {\r\n  //   const chatSocket = new WebSocket(`ws://${window.location.host}/ws/chat/${selectedChatId}/`);\r\n\r\n  //   chatSocket.onmessage = function (e) {\r\n  //     const data = JSON.parse(e.data);\r\n  //     // 받은 메시지 처리 로직 (예시: 채팅 목록을 다시 가져오는 것처럼)\r\n  //     const { sender, receiver, message } = data;\r\n  //     axios.get(\"http://127.0.0.1:8000/dm.do\", {\r\n  //       params: {\r\n  //         select: 3,\r\n  //         dm: message.text,\r\n  //         me: receiver,\r\n  //         you: sender,\r\n  //       },\r\n  //     }).then((response) => {\r\n  //       // 메시지 전송 후 채팅 목록을 다시 가져옴\r\n  //       fetchChats();\r\n  //     }).catch(error => {\r\n  //       console.error('Error sending message:', error);\r\n  //     });\r\n  //   };\r\n\r\n  //   chatSocket.onclose = function (e) {\r\n  //     console.error('Chat socket closed unexpectedly');\r\n  //   };\r\n\r\n  //   return () => {\r\n  //     chatSocket.close();\r\n  //   };\r\n\r\n  // };\r\n\r\n  const selectChat = (id) => {\r\n    //  'id': partner_id,\r\n    setSelectedChatId(id);\r\n  };\r\n\r\n  const selectedChat = chats.find((chat) => chat.id === selectedChatId);\r\n\r\n  return (\r\n    <AppContainer>\r\n      <AppBox>\r\n        <ChatList chats={chats} selectChat={selectChat} />\r\n        <ChatSection>\r\n          {selectedChat && (\r\n            <>\r\n              <ChatWindow\r\n                messages={selectedChat.messages}\r\n                selectedChatId={selectedChatId}\r\n              />\r\n              <MessageInput\r\n                sendMessage={sendMessage}\r\n                curUserid={currentUserid}\r\n                receiv_id={selectedChatId}\r\n              />\r\n            </>\r\n          )}\r\n        </ChatSection>\r\n      </AppBox>\r\n    </AppContainer>\r\n  );\r\n};\r\n\r\nexport default DirectMessages;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}